from NL.CommonConcepts.Configurations.Utilities import wrap

# Set up lattice
vector_a = [18.456, 0.0, 0.0]*Angstrom
vector_b = [0.0, 15.98337, 0.0]*Angstrom
vector_c = [0.0, 0.0, 20.192]*Angstrom
lattice = UnitCell(vector_a, vector_b, vector_c)

# Define elements
elements = [Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon,
            Carbon, Carbon, Carbon, Carbon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon,
            Silicon, Silicon, Silicon, Silicon, Silicon, Silicon, Silicon]

# Define coordinates
fractional_coordinates = [[-0.            ,  0.            ,  0.086345087163],
                          [-0.            ,  0.            ,  0.336345087163],
                          [-0.            ,  0.            ,  0.586345087163],
                          [-0.            ,  0.            ,  0.836345087163],
                          [-0.            ,  0.333333333333,  0.086345087163],
                          [-0.            ,  0.333333333333,  0.336345087163],
                          [-0.            ,  0.333333333333,  0.586345087163],
                          [-0.            ,  0.333333333333,  0.836345087163],
                          [-0.            ,  0.666666666667,  0.086345087163],
                          [-0.            ,  0.666666666667,  0.336345087163],
                          [-0.            ,  0.666666666667,  0.586345087163],
                          [-0.            ,  0.666666666667,  0.836345087163],
                          [ 0.333333333333,  0.            ,  0.086345087163],
                          [ 0.333333333333,  0.            ,  0.336345087163],
                          [ 0.333333333333,  0.            ,  0.586345087163],
                          [ 0.333333333333,  0.            ,  0.836345087163],
                          [ 0.333333333333,  0.333333333333,  0.086345087163],
                          [ 0.333333333333,  0.333333333333,  0.336345087163],
                          [ 0.333333333333,  0.333333333333,  0.586345087163],
                          [ 0.333333333333,  0.333333333333,  0.836345087163],
                          [ 0.333333333333,  0.666666666667,  0.086345087163],
                          [ 0.333333333333,  0.666666666667,  0.336345087163],
                          [ 0.333333333333,  0.666666666667,  0.586345087163],
                          [ 0.333333333333,  0.666666666667,  0.836345087163],
                          [ 0.666666666667,  0.            ,  0.086345087163],
                          [ 0.666666666667,  0.            ,  0.336345087163],
                          [ 0.666666666667,  0.            ,  0.586345087163],
                          [ 0.666666666667,  0.            ,  0.836345087163],
                          [ 0.666666666667,  0.333333333333,  0.086345087163],
                          [ 0.666666666667,  0.333333333333,  0.336345087163],
                          [ 0.666666666667,  0.333333333333,  0.586345087163],
                          [ 0.666666666667,  0.333333333333,  0.836345087163],
                          [ 0.666666666667,  0.666666666667,  0.086345087163],
                          [ 0.666666666667,  0.666666666667,  0.336345087163],
                          [ 0.666666666667,  0.666666666667,  0.586345087163],
                          [ 0.666666666667,  0.666666666667,  0.836345087163],
                          [ 0.166666666667,  0.            ,  0.086345087163],
                          [ 0.166666666667,  0.            ,  0.336345087163],
                          [ 0.166666666667,  0.            ,  0.586345087163],
                          [ 0.166666666667,  0.            ,  0.836345087163],
                          [ 0.166666666667,  0.333333333333,  0.086345087163],
                          [ 0.166666666667,  0.333333333333,  0.336345087163],
                          [ 0.166666666667,  0.333333333333,  0.586345087163],
                          [ 0.166666666667,  0.333333333333,  0.836345087163],
                          [ 0.166666666667,  0.666666666667,  0.086345087163],
                          [ 0.166666666667,  0.666666666667,  0.336345087163],
                          [ 0.166666666667,  0.666666666667,  0.586345087163],
                          [ 0.166666666667,  0.666666666667,  0.836345087163],
                          [ 0.5           ,  0.            ,  0.086345087163],
                          [ 0.5           ,  0.            ,  0.336345087163],
                          [ 0.5           ,  0.            ,  0.586345087163],
                          [ 0.5           ,  0.            ,  0.836345087163],
                          [ 0.5           ,  0.333333333333,  0.086345087163],
                          [ 0.5           ,  0.333333333333,  0.336345087163],
                          [ 0.5           ,  0.333333333333,  0.586345087163],
                          [ 0.5           ,  0.333333333333,  0.836345087163],
                          [ 0.5           ,  0.666666666667,  0.086345087163],
                          [ 0.5           ,  0.666666666667,  0.336345087163],
                          [ 0.5           ,  0.666666666667,  0.586345087163],
                          [ 0.5           ,  0.666666666667,  0.836345087163],
                          [ 0.833333333333,  0.            ,  0.086345087163],
                          [ 0.833333333333,  0.            ,  0.336345087163],
                          [ 0.833333333333,  0.            ,  0.586345087163],
                          [ 0.833333333333,  0.            ,  0.836345087163],
                          [ 0.833333333333,  0.333333333333,  0.086345087163],
                          [ 0.833333333333,  0.333333333333,  0.336345087163],
                          [ 0.833333333333,  0.333333333333,  0.586345087163],
                          [ 0.833333333333,  0.333333333333,  0.836345087163],
                          [ 0.833333333333,  0.666666666667,  0.086345087163],
                          [ 0.833333333333,  0.666666666667,  0.336345087163],
                          [ 0.833333333333,  0.666666666667,  0.586345087163],
                          [ 0.833333333333,  0.666666666667,  0.836345087163],
                          [ 0.25          ,  0.166666612988,  0.086345087163],
                          [ 0.25          ,  0.166666612988,  0.336345087163],
                          [ 0.25          ,  0.166666612988,  0.586345087163],
                          [ 0.25          ,  0.166666612988,  0.836345087163],
                          [ 0.25          ,  0.499999946322,  0.086345087163],
                          [ 0.25          ,  0.499999946322,  0.336345087163],
                          [ 0.25          ,  0.499999946322,  0.586345087163],
                          [ 0.25          ,  0.499999946322,  0.836345087163],
                          [ 0.25          ,  0.833333279655,  0.086345087163],
                          [ 0.25          ,  0.833333279655,  0.336345087163],
                          [ 0.25          ,  0.833333279655,  0.586345087163],
                          [ 0.25          ,  0.833333279655,  0.836345087163],
                          [ 0.583333333333,  0.166666612988,  0.086345087163],
                          [ 0.583333333333,  0.166666612988,  0.336345087163],
                          [ 0.583333333333,  0.166666612988,  0.586345087163],
                          [ 0.583333333333,  0.166666612988,  0.836345087163],
                          [ 0.583333333333,  0.499999946322,  0.086345087163],
                          [ 0.583333333333,  0.499999946322,  0.336345087163],
                          [ 0.583333333333,  0.499999946322,  0.586345087163],
                          [ 0.583333333333,  0.499999946322,  0.836345087163],
                          [ 0.583333333333,  0.833333279655,  0.086345087163],
                          [ 0.583333333333,  0.833333279655,  0.336345087163],
                          [ 0.583333333333,  0.833333279655,  0.586345087163],
                          [ 0.583333333333,  0.833333279655,  0.836345087163],
                          [ 0.916666666667,  0.166666612988,  0.086345087163],
                          [ 0.916666666667,  0.166666612988,  0.336345087163],
                          [ 0.916666666667,  0.166666612988,  0.586345087163],
                          [ 0.916666666667,  0.166666612988,  0.836345087163],
                          [ 0.916666666667,  0.499999946322,  0.086345087163],
                          [ 0.916666666667,  0.499999946322,  0.336345087163],
                          [ 0.916666666667,  0.499999946322,  0.586345087163],
                          [ 0.916666666667,  0.499999946322,  0.836345087163],
                          [ 0.916666666667,  0.833333279655,  0.086345087163],
                          [ 0.916666666667,  0.833333279655,  0.336345087163],
                          [ 0.916666666667,  0.833333279655,  0.586345087163],
                          [ 0.916666666667,  0.833333279655,  0.836345087163],
                          [ 0.083333333333,  0.166666612988,  0.086345087163],
                          [ 0.083333333333,  0.166666612988,  0.336345087163],
                          [ 0.083333333333,  0.166666612988,  0.586345087163],
                          [ 0.083333333333,  0.166666612988,  0.836345087163],
                          [ 0.083333333333,  0.499999946322,  0.086345087163],
                          [ 0.083333333333,  0.499999946322,  0.336345087163],
                          [ 0.083333333333,  0.499999946322,  0.586345087163],
                          [ 0.083333333333,  0.499999946322,  0.836345087163],
                          [ 0.083333333333,  0.833333279655,  0.086345087163],
                          [ 0.083333333333,  0.833333279655,  0.336345087163],
                          [ 0.083333333333,  0.833333279655,  0.586345087163],
                          [ 0.083333333333,  0.833333279655,  0.836345087163],
                          [ 0.416666666667,  0.166666612988,  0.086345087163],
                          [ 0.416666666667,  0.166666612988,  0.336345087163],
                          [ 0.416666666667,  0.166666612988,  0.586345087163],
                          [ 0.416666666667,  0.166666612988,  0.836345087163],
                          [ 0.416666666667,  0.499999946322,  0.086345087163],
                          [ 0.416666666667,  0.499999946322,  0.336345087163],
                          [ 0.416666666667,  0.499999946322,  0.586345087163],
                          [ 0.416666666667,  0.499999946322,  0.836345087163],
                          [ 0.416666666667,  0.833333279655,  0.086345087163],
                          [ 0.416666666667,  0.833333279655,  0.336345087163],
                          [ 0.416666666667,  0.833333279655,  0.586345087163],
                          [ 0.416666666667,  0.833333279655,  0.836345087163],
                          [ 0.75          ,  0.166666612988,  0.086345087163],
                          [ 0.75          ,  0.166666612988,  0.336345087163],
                          [ 0.75          ,  0.166666612988,  0.586345087163],
                          [ 0.75          ,  0.166666612988,  0.836345087163],
                          [ 0.75          ,  0.499999946322,  0.086345087163],
                          [ 0.75          ,  0.499999946322,  0.336345087163],
                          [ 0.75          ,  0.499999946322,  0.586345087163],
                          [ 0.75          ,  0.499999946322,  0.836345087163],
                          [ 0.75          ,  0.833333279655,  0.086345087163],
                          [ 0.75          ,  0.833333279655,  0.336345087163],
                          [ 0.75          ,  0.833333279655,  0.586345087163],
                          [ 0.75          ,  0.833333279655,  0.836345087163],
                          [-0.            ,  0.111111075326,  0.115095087163],
                          [-0.            ,  0.111111075326,  0.365095087163],
                          [-0.            ,  0.111111075326,  0.615095087163],
                          [-0.            ,  0.111111075326,  0.865095087163],
                          [-0.            ,  0.444444408659,  0.115095087163],
                          [-0.            ,  0.444444408659,  0.365095087163],
                          [-0.            ,  0.444444408659,  0.615095087163],
                          [-0.            ,  0.444444408659,  0.865095087163],
                          [-0.            ,  0.777777741992,  0.115095087163],
                          [-0.            ,  0.777777741992,  0.365095087163],
                          [-0.            ,  0.777777741992,  0.615095087163],
                          [-0.            ,  0.777777741992,  0.865095087163],
                          [ 0.333333333333,  0.111111075326,  0.115095087163],
                          [ 0.333333333333,  0.111111075326,  0.365095087163],
                          [ 0.333333333333,  0.111111075326,  0.615095087163],
                          [ 0.333333333333,  0.111111075326,  0.865095087163],
                          [ 0.333333333333,  0.444444408659,  0.115095087163],
                          [ 0.333333333333,  0.444444408659,  0.365095087163],
                          [ 0.333333333333,  0.444444408659,  0.615095087163],
                          [ 0.333333333333,  0.444444408659,  0.865095087163],
                          [ 0.333333333333,  0.777777741992,  0.115095087163],
                          [ 0.333333333333,  0.777777741992,  0.365095087163],
                          [ 0.333333333333,  0.777777741992,  0.615095087163],
                          [ 0.333333333333,  0.777777741992,  0.865095087163],
                          [ 0.666666666667,  0.111111075326,  0.115095087163],
                          [ 0.666666666667,  0.111111075326,  0.365095087163],
                          [ 0.666666666667,  0.111111075326,  0.615095087163],
                          [ 0.666666666667,  0.111111075326,  0.865095087163],
                          [ 0.666666666667,  0.444444408659,  0.115095087163],
                          [ 0.666666666667,  0.444444408659,  0.365095087163],
                          [ 0.666666666667,  0.444444408659,  0.615095087163],
                          [ 0.666666666667,  0.444444408659,  0.865095087163],
                          [ 0.666666666667,  0.777777741992,  0.115095087163],
                          [ 0.666666666667,  0.777777741992,  0.365095087163],
                          [ 0.666666666667,  0.777777741992,  0.615095087163],
                          [ 0.666666666667,  0.777777741992,  0.865095087163],
                          [ 0.166666666667,  0.111111075326,  0.115095087163],
                          [ 0.166666666667,  0.111111075326,  0.365095087163],
                          [ 0.166666666667,  0.111111075326,  0.615095087163],
                          [ 0.166666666667,  0.111111075326,  0.865095087163],
                          [ 0.166666666667,  0.444444408659,  0.115095087163],
                          [ 0.166666666667,  0.444444408659,  0.365095087163],
                          [ 0.166666666667,  0.444444408659,  0.615095087163],
                          [ 0.166666666667,  0.444444408659,  0.865095087163],
                          [ 0.166666666667,  0.777777741992,  0.115095087163],
                          [ 0.166666666667,  0.777777741992,  0.365095087163],
                          [ 0.166666666667,  0.777777741992,  0.615095087163],
                          [ 0.166666666667,  0.777777741992,  0.865095087163],
                          [ 0.5           ,  0.111111075326,  0.115095087163],
                          [ 0.5           ,  0.111111075326,  0.365095087163],
                          [ 0.5           ,  0.111111075326,  0.615095087163],
                          [ 0.5           ,  0.111111075326,  0.865095087163],
                          [ 0.5           ,  0.444444408659,  0.115095087163],
                          [ 0.5           ,  0.444444408659,  0.365095087163],
                          [ 0.5           ,  0.444444408659,  0.615095087163],
                          [ 0.5           ,  0.444444408659,  0.865095087163],
                          [ 0.5           ,  0.777777741992,  0.115095087163],
                          [ 0.5           ,  0.777777741992,  0.365095087163],
                          [ 0.5           ,  0.777777741992,  0.615095087163],
                          [ 0.5           ,  0.777777741992,  0.865095087163],
                          [ 0.833333333333,  0.111111075326,  0.115095087163],
                          [ 0.833333333333,  0.111111075326,  0.365095087163],
                          [ 0.833333333333,  0.111111075326,  0.615095087163],
                          [ 0.833333333333,  0.111111075326,  0.865095087163],
                          [ 0.833333333333,  0.444444408659,  0.115095087163],
                          [ 0.833333333333,  0.444444408659,  0.365095087163],
                          [ 0.833333333333,  0.444444408659,  0.615095087163],
                          [ 0.833333333333,  0.444444408659,  0.865095087163],
                          [ 0.833333333333,  0.777777741992,  0.115095087163],
                          [ 0.833333333333,  0.777777741992,  0.365095087163],
                          [ 0.833333333333,  0.777777741992,  0.615095087163],
                          [ 0.833333333333,  0.777777741992,  0.865095087163],
                          [ 0.25          ,  0.277777688314,  0.115095087163],
                          [ 0.25          ,  0.277777688314,  0.365095087163],
                          [ 0.25          ,  0.277777688314,  0.615095087163],
                          [ 0.25          ,  0.277777688314,  0.865095087163],
                          [ 0.25          ,  0.611111021647,  0.115095087163],
                          [ 0.25          ,  0.611111021647,  0.365095087163],
                          [ 0.25          ,  0.611111021647,  0.615095087163],
                          [ 0.25          ,  0.611111021647,  0.865095087163],
                          [ 0.25          ,  0.944444354981,  0.115095087163],
                          [ 0.25          ,  0.944444354981,  0.365095087163],
                          [ 0.25          ,  0.944444354981,  0.615095087163],
                          [ 0.25          ,  0.944444354981,  0.865095087163],
                          [ 0.583333333333,  0.277777688314,  0.115095087163],
                          [ 0.583333333333,  0.277777688314,  0.365095087163],
                          [ 0.583333333333,  0.277777688314,  0.615095087163],
                          [ 0.583333333333,  0.277777688314,  0.865095087163],
                          [ 0.583333333333,  0.611111021647,  0.115095087163],
                          [ 0.583333333333,  0.611111021647,  0.365095087163],
                          [ 0.583333333333,  0.611111021647,  0.615095087163],
                          [ 0.583333333333,  0.611111021647,  0.865095087163],
                          [ 0.583333333333,  0.944444354981,  0.115095087163],
                          [ 0.583333333333,  0.944444354981,  0.365095087163],
                          [ 0.583333333333,  0.944444354981,  0.615095087163],
                          [ 0.583333333333,  0.944444354981,  0.865095087163],
                          [ 0.916666666667,  0.277777688314,  0.115095087163],
                          [ 0.916666666667,  0.277777688314,  0.365095087163],
                          [ 0.916666666667,  0.277777688314,  0.615095087163],
                          [ 0.916666666667,  0.277777688314,  0.865095087163],
                          [ 0.916666666667,  0.611111021647,  0.115095087163],
                          [ 0.916666666667,  0.611111021647,  0.365095087163],
                          [ 0.916666666667,  0.611111021647,  0.615095087163],
                          [ 0.916666666667,  0.611111021647,  0.865095087163],
                          [ 0.916666666667,  0.944444354981,  0.115095087163],
                          [ 0.916666666667,  0.944444354981,  0.365095087163],
                          [ 0.916666666667,  0.944444354981,  0.615095087163],
                          [ 0.916666666667,  0.944444354981,  0.865095087163],
                          [ 0.083333333333,  0.277777688314,  0.115095087163],
                          [ 0.083333333333,  0.277777688314,  0.365095087163],
                          [ 0.083333333333,  0.277777688314,  0.615095087163],
                          [ 0.083333333333,  0.277777688314,  0.865095087163],
                          [ 0.083333333333,  0.611111021647,  0.115095087163],
                          [ 0.083333333333,  0.611111021647,  0.365095087163],
                          [ 0.083333333333,  0.611111021647,  0.615095087163],
                          [ 0.083333333333,  0.611111021647,  0.865095087163],
                          [ 0.083333333333,  0.944444354981,  0.115095087163],
                          [ 0.083333333333,  0.944444354981,  0.365095087163],
                          [ 0.083333333333,  0.944444354981,  0.615095087163],
                          [ 0.083333333333,  0.944444354981,  0.865095087163],
                          [ 0.416666666667,  0.277777688314,  0.115095087163],
                          [ 0.416666666667,  0.277777688314,  0.365095087163],
                          [ 0.416666666667,  0.277777688314,  0.615095087163],
                          [ 0.416666666667,  0.277777688314,  0.865095087163],
                          [ 0.416666666667,  0.611111021647,  0.115095087163],
                          [ 0.416666666667,  0.611111021647,  0.365095087163],
                          [ 0.416666666667,  0.611111021647,  0.615095087163],
                          [ 0.416666666667,  0.611111021647,  0.865095087163],
                          [ 0.416666666667,  0.944444354981,  0.115095087163],
                          [ 0.416666666667,  0.944444354981,  0.365095087163],
                          [ 0.416666666667,  0.944444354981,  0.615095087163],
                          [ 0.416666666667,  0.944444354981,  0.865095087163],
                          [ 0.75          ,  0.277777688314,  0.115095087163],
                          [ 0.75          ,  0.277777688314,  0.365095087163],
                          [ 0.75          ,  0.277777688314,  0.615095087163],
                          [ 0.75          ,  0.277777688314,  0.865095087163],
                          [ 0.75          ,  0.611111021647,  0.115095087163],
                          [ 0.75          ,  0.611111021647,  0.365095087163],
                          [ 0.75          ,  0.611111021647,  0.615095087163],
                          [ 0.75          ,  0.611111021647,  0.865095087163],
                          [ 0.75          ,  0.944444354981,  0.115095087163],
                          [ 0.75          ,  0.944444354981,  0.365095087163],
                          [ 0.75          ,  0.944444354981,  0.615095087163],
                          [ 0.75          ,  0.944444354981,  0.865095087163],
                          [-0.            ,  0.111111075326,  0.211345087163],
                          [-0.            ,  0.111111075326,  0.461345087163],
                          [-0.            ,  0.111111075326,  0.711345087163],
                          [-0.            ,  0.111111075326,  0.961345087163],
                          [-0.            ,  0.444444408659,  0.211345087163],
                          [-0.            ,  0.444444408659,  0.461345087163],
                          [-0.            ,  0.444444408659,  0.711345087163],
                          [-0.            ,  0.444444408659,  0.961345087163],
                          [-0.            ,  0.777777741992,  0.211345087163],
                          [-0.            ,  0.777777741992,  0.461345087163],
                          [-0.            ,  0.777777741992,  0.711345087163],
                          [-0.            ,  0.777777741992,  0.961345087163],
                          [ 0.333333333333,  0.111111075326,  0.211345087163],
                          [ 0.333333333333,  0.111111075326,  0.461345087163],
                          [ 0.333333333333,  0.111111075326,  0.711345087163],
                          [ 0.333333333333,  0.111111075326,  0.961345087163],
                          [ 0.333333333333,  0.444444408659,  0.211345087163],
                          [ 0.333333333333,  0.444444408659,  0.461345087163],
                          [ 0.333333333333,  0.444444408659,  0.711345087163],
                          [ 0.333333333333,  0.444444408659,  0.961345087163],
                          [ 0.333333333333,  0.777777741992,  0.211345087163],
                          [ 0.333333333333,  0.777777741992,  0.461345087163],
                          [ 0.333333333333,  0.777777741992,  0.711345087163],
                          [ 0.333333333333,  0.777777741992,  0.961345087163],
                          [ 0.666666666667,  0.111111075326,  0.211345087163],
                          [ 0.666666666667,  0.111111075326,  0.461345087163],
                          [ 0.666666666667,  0.111111075326,  0.711345087163],
                          [ 0.666666666667,  0.111111075326,  0.961345087163],
                          [ 0.666666666667,  0.444444408659,  0.211345087163],
                          [ 0.666666666667,  0.444444408659,  0.461345087163],
                          [ 0.666666666667,  0.444444408659,  0.711345087163],
                          [ 0.666666666667,  0.444444408659,  0.961345087163],
                          [ 0.666666666667,  0.777777741992,  0.211345087163],
                          [ 0.666666666667,  0.777777741992,  0.461345087163],
                          [ 0.666666666667,  0.777777741992,  0.711345087163],
                          [ 0.666666666667,  0.777777741992,  0.961345087163],
                          [ 0.166666666667,  0.111111075326,  0.211345087163],
                          [ 0.166666666667,  0.111111075326,  0.461345087163],
                          [ 0.166666666667,  0.111111075326,  0.711345087163],
                          [ 0.166666666667,  0.111111075326,  0.961345087163],
                          [ 0.166666666667,  0.444444408659,  0.211345087163],
                          [ 0.166666666667,  0.444444408659,  0.461345087163],
                          [ 0.166666666667,  0.444444408659,  0.711345087163],
                          [ 0.166666666667,  0.444444408659,  0.961345087163],
                          [ 0.166666666667,  0.777777741992,  0.211345087163],
                          [ 0.166666666667,  0.777777741992,  0.461345087163],
                          [ 0.166666666667,  0.777777741992,  0.711345087163],
                          [ 0.166666666667,  0.777777741992,  0.961345087163],
                          [ 0.5           ,  0.111111075326,  0.211345087163],
                          [ 0.5           ,  0.111111075326,  0.461345087163],
                          [ 0.5           ,  0.111111075326,  0.711345087163],
                          [ 0.5           ,  0.111111075326,  0.961345087163],
                          [ 0.5           ,  0.444444408659,  0.211345087163],
                          [ 0.5           ,  0.444444408659,  0.461345087163],
                          [ 0.5           ,  0.444444408659,  0.711345087163],
                          [ 0.5           ,  0.444444408659,  0.961345087163],
                          [ 0.5           ,  0.777777741992,  0.211345087163],
                          [ 0.5           ,  0.777777741992,  0.461345087163],
                          [ 0.5           ,  0.777777741992,  0.711345087163],
                          [ 0.5           ,  0.777777741992,  0.961345087163],
                          [ 0.833333333333,  0.111111075326,  0.211345087163],
                          [ 0.833333333333,  0.111111075326,  0.461345087163],
                          [ 0.833333333333,  0.111111075326,  0.711345087163],
                          [ 0.833333333333,  0.111111075326,  0.961345087163],
                          [ 0.833333333333,  0.444444408659,  0.211345087163],
                          [ 0.833333333333,  0.444444408659,  0.461345087163],
                          [ 0.833333333333,  0.444444408659,  0.711345087163],
                          [ 0.833333333333,  0.444444408659,  0.961345087163],
                          [ 0.833333333333,  0.777777741992,  0.211345087163],
                          [ 0.833333333333,  0.777777741992,  0.461345087163],
                          [ 0.833333333333,  0.777777741992,  0.711345087163],
                          [ 0.833333333333,  0.777777741992,  0.961345087163],
                          [ 0.25          ,  0.277777688314,  0.211345087163],
                          [ 0.25          ,  0.277777688314,  0.461345087163],
                          [ 0.25          ,  0.277777688314,  0.711345087163],
                          [ 0.25          ,  0.277777688314,  0.961345087163],
                          [ 0.25          ,  0.611111021647,  0.211345087163],
                          [ 0.25          ,  0.611111021647,  0.461345087163],
                          [ 0.25          ,  0.611111021647,  0.711345087163],
                          [ 0.25          ,  0.611111021647,  0.961345087163],
                          [ 0.25          ,  0.944444354981,  0.211345087163],
                          [ 0.25          ,  0.944444354981,  0.461345087163],
                          [ 0.25          ,  0.944444354981,  0.711345087163],
                          [ 0.25          ,  0.944444354981,  0.961345087163],
                          [ 0.583333333333,  0.277777688314,  0.211345087163],
                          [ 0.583333333333,  0.277777688314,  0.461345087163],
                          [ 0.583333333333,  0.277777688314,  0.711345087163],
                          [ 0.583333333333,  0.277777688314,  0.961345087163],
                          [ 0.583333333333,  0.611111021647,  0.211345087163],
                          [ 0.583333333333,  0.611111021647,  0.461345087163],
                          [ 0.583333333333,  0.611111021647,  0.711345087163],
                          [ 0.583333333333,  0.611111021647,  0.961345087163],
                          [ 0.583333333333,  0.944444354981,  0.211345087163],
                          [ 0.583333333333,  0.944444354981,  0.461345087163],
                          [ 0.583333333333,  0.944444354981,  0.711345087163],
                          [ 0.583333333333,  0.944444354981,  0.961345087163],
                          [ 0.916666666667,  0.277777688314,  0.211345087163],
                          [ 0.916666666667,  0.277777688314,  0.461345087163],
                          [ 0.916666666667,  0.277777688314,  0.711345087163],
                          [ 0.916666666667,  0.277777688314,  0.961345087163],
                          [ 0.916666666667,  0.611111021647,  0.211345087163],
                          [ 0.916666666667,  0.611111021647,  0.461345087163],
                          [ 0.916666666667,  0.611111021647,  0.711345087163],
                          [ 0.916666666667,  0.611111021647,  0.961345087163],
                          [ 0.916666666667,  0.944444354981,  0.211345087163],
                          [ 0.916666666667,  0.944444354981,  0.461345087163],
                          [ 0.916666666667,  0.944444354981,  0.711345087163],
                          [ 0.916666666667,  0.944444354981,  0.961345087163],
                          [ 0.083333333333,  0.277777688314,  0.211345087163],
                          [ 0.083333333333,  0.277777688314,  0.461345087163],
                          [ 0.083333333333,  0.277777688314,  0.711345087163],
                          [ 0.083333333333,  0.277777688314,  0.961345087163],
                          [ 0.083333333333,  0.611111021647,  0.211345087163],
                          [ 0.083333333333,  0.611111021647,  0.461345087163],
                          [ 0.083333333333,  0.611111021647,  0.711345087163],
                          [ 0.083333333333,  0.611111021647,  0.961345087163],
                          [ 0.083333333333,  0.944444354981,  0.211345087163],
                          [ 0.083333333333,  0.944444354981,  0.461345087163],
                          [ 0.083333333333,  0.944444354981,  0.711345087163],
                          [ 0.083333333333,  0.944444354981,  0.961345087163],
                          [ 0.416666666667,  0.277777688314,  0.211345087163],
                          [ 0.416666666667,  0.277777688314,  0.461345087163],
                          [ 0.416666666667,  0.277777688314,  0.711345087163],
                          [ 0.416666666667,  0.277777688314,  0.961345087163],
                          [ 0.416666666667,  0.611111021647,  0.211345087163],
                          [ 0.416666666667,  0.611111021647,  0.461345087163],
                          [ 0.416666666667,  0.611111021647,  0.711345087163],
                          [ 0.416666666667,  0.611111021647,  0.961345087163],
                          [ 0.416666666667,  0.944444354981,  0.211345087163],
                          [ 0.416666666667,  0.944444354981,  0.461345087163],
                          [ 0.416666666667,  0.944444354981,  0.711345087163],
                          [ 0.416666666667,  0.944444354981,  0.961345087163],
                          [ 0.75          ,  0.277777688314,  0.211345087163],
                          [ 0.75          ,  0.277777688314,  0.461345087163],
                          [ 0.75          ,  0.277777688314,  0.711345087163],
                          [ 0.75          ,  0.277777688314,  0.961345087163],
                          [ 0.75          ,  0.611111021647,  0.211345087163],
                          [ 0.75          ,  0.611111021647,  0.461345087163],
                          [ 0.75          ,  0.611111021647,  0.711345087163],
                          [ 0.75          ,  0.611111021647,  0.961345087163],
                          [ 0.75          ,  0.944444354981,  0.211345087163],
                          [ 0.75          ,  0.944444354981,  0.461345087163],
                          [ 0.75          ,  0.944444354981,  0.711345087163],
                          [ 0.75          ,  0.944444354981,  0.961345087163],
                          [-0.            ,  0.            ,  0.240095087163],
                          [-0.            ,  0.            ,  0.490095087163],
                          [-0.            ,  0.            ,  0.740095087163],
                          [-0.            ,  0.            ,  0.990095087163],
                          [-0.            ,  0.333333333333,  0.240095087163],
                          [-0.            ,  0.333333333333,  0.490095087163],
                          [-0.            ,  0.333333333333,  0.740095087163],
                          [-0.            ,  0.333333333333,  0.990095087163],
                          [-0.            ,  0.666666666667,  0.240095087163],
                          [-0.            ,  0.666666666667,  0.490095087163],
                          [-0.            ,  0.666666666667,  0.740095087163],
                          [-0.            ,  0.666666666667,  0.990095087163],
                          [ 0.333333333333,  0.            ,  0.240095087163],
                          [ 0.333333333333,  0.            ,  0.490095087163],
                          [ 0.333333333333,  0.            ,  0.740095087163],
                          [ 0.333333333333,  0.            ,  0.990095087163],
                          [ 0.333333333333,  0.333333333333,  0.240095087163],
                          [ 0.333333333333,  0.333333333333,  0.490095087163],
                          [ 0.333333333333,  0.333333333333,  0.740095087163],
                          [ 0.333333333333,  0.333333333333,  0.990095087163],
                          [ 0.333333333333,  0.666666666667,  0.240095087163],
                          [ 0.333333333333,  0.666666666667,  0.490095087163],
                          [ 0.333333333333,  0.666666666667,  0.740095087163],
                          [ 0.333333333333,  0.666666666667,  0.990095087163],
                          [ 0.666666666667,  0.            ,  0.240095087163],
                          [ 0.666666666667,  0.            ,  0.490095087163],
                          [ 0.666666666667,  0.            ,  0.740095087163],
                          [ 0.666666666667,  0.            ,  0.990095087163],
                          [ 0.666666666667,  0.333333333333,  0.240095087163],
                          [ 0.666666666667,  0.333333333333,  0.490095087163],
                          [ 0.666666666667,  0.333333333333,  0.740095087163],
                          [ 0.666666666667,  0.333333333333,  0.990095087163],
                          [ 0.666666666667,  0.666666666667,  0.240095087163],
                          [ 0.666666666667,  0.666666666667,  0.490095087163],
                          [ 0.666666666667,  0.666666666667,  0.740095087163],
                          [ 0.666666666667,  0.666666666667,  0.990095087163],
                          [ 0.166666666667,  0.            ,  0.240095087163],
                          [ 0.166666666667,  0.            ,  0.490095087163],
                          [ 0.166666666667,  0.            ,  0.740095087163],
                          [ 0.166666666667,  0.            ,  0.990095087163],
                          [ 0.166666666667,  0.333333333333,  0.240095087163],
                          [ 0.166666666667,  0.333333333333,  0.490095087163],
                          [ 0.166666666667,  0.333333333333,  0.740095087163],
                          [ 0.166666666667,  0.333333333333,  0.990095087163],
                          [ 0.166666666667,  0.666666666667,  0.240095087163],
                          [ 0.166666666667,  0.666666666667,  0.490095087163],
                          [ 0.166666666667,  0.666666666667,  0.740095087163],
                          [ 0.166666666667,  0.666666666667,  0.990095087163],
                          [ 0.5           ,  0.            ,  0.240095087163],
                          [ 0.5           ,  0.            ,  0.490095087163],
                          [ 0.5           ,  0.            ,  0.740095087163],
                          [ 0.5           ,  0.            ,  0.990095087163],
                          [ 0.5           ,  0.333333333333,  0.240095087163],
                          [ 0.5           ,  0.333333333333,  0.490095087163],
                          [ 0.5           ,  0.333333333333,  0.740095087163],
                          [ 0.5           ,  0.333333333333,  0.990095087163],
                          [ 0.5           ,  0.666666666667,  0.240095087163],
                          [ 0.5           ,  0.666666666667,  0.490095087163],
                          [ 0.5           ,  0.666666666667,  0.740095087163],
                          [ 0.5           ,  0.666666666667,  0.990095087163],
                          [ 0.833333333333,  0.            ,  0.240095087163],
                          [ 0.833333333333,  0.            ,  0.490095087163],
                          [ 0.833333333333,  0.            ,  0.740095087163],
                          [ 0.833333333333,  0.            ,  0.990095087163],
                          [ 0.833333333333,  0.333333333333,  0.240095087163],
                          [ 0.833333333333,  0.333333333333,  0.490095087163],
                          [ 0.833333333333,  0.333333333333,  0.740095087163],
                          [ 0.833333333333,  0.333333333333,  0.990095087163],
                          [ 0.833333333333,  0.666666666667,  0.240095087163],
                          [ 0.833333333333,  0.666666666667,  0.490095087163],
                          [ 0.833333333333,  0.666666666667,  0.740095087163],
                          [ 0.833333333333,  0.666666666667,  0.990095087163],
                          [ 0.25          ,  0.166666612988,  0.240095087163],
                          [ 0.25          ,  0.166666612988,  0.490095087163],
                          [ 0.25          ,  0.166666612988,  0.740095087163],
                          [ 0.25          ,  0.166666612988,  0.990095087163],
                          [ 0.25          ,  0.499999946322,  0.240095087163],
                          [ 0.25          ,  0.499999946322,  0.490095087163],
                          [ 0.25          ,  0.499999946322,  0.740095087163],
                          [ 0.25          ,  0.499999946322,  0.990095087163],
                          [ 0.25          ,  0.833333279655,  0.240095087163],
                          [ 0.25          ,  0.833333279655,  0.490095087163],
                          [ 0.25          ,  0.833333279655,  0.740095087163],
                          [ 0.25          ,  0.833333279655,  0.990095087163],
                          [ 0.583333333333,  0.166666612988,  0.240095087163],
                          [ 0.583333333333,  0.166666612988,  0.490095087163],
                          [ 0.583333333333,  0.166666612988,  0.740095087163],
                          [ 0.583333333333,  0.166666612988,  0.990095087163],
                          [ 0.583333333333,  0.499999946322,  0.240095087163],
                          [ 0.583333333333,  0.499999946322,  0.490095087163],
                          [ 0.583333333333,  0.499999946322,  0.740095087163],
                          [ 0.583333333333,  0.499999946322,  0.990095087163],
                          [ 0.583333333333,  0.833333279655,  0.240095087163],
                          [ 0.583333333333,  0.833333279655,  0.490095087163],
                          [ 0.583333333333,  0.833333279655,  0.740095087163],
                          [ 0.583333333333,  0.833333279655,  0.990095087163],
                          [ 0.916666666667,  0.166666612988,  0.240095087163],
                          [ 0.916666666667,  0.166666612988,  0.490095087163],
                          [ 0.916666666667,  0.166666612988,  0.740095087163],
                          [ 0.916666666667,  0.166666612988,  0.990095087163],
                          [ 0.916666666667,  0.499999946322,  0.240095087163],
                          [ 0.916666666667,  0.499999946322,  0.490095087163],
                          [ 0.916666666667,  0.499999946322,  0.740095087163],
                          [ 0.916666666667,  0.499999946322,  0.990095087163],
                          [ 0.916666666667,  0.833333279655,  0.240095087163],
                          [ 0.916666666667,  0.833333279655,  0.490095087163],
                          [ 0.916666666667,  0.833333279655,  0.740095087163],
                          [ 0.916666666667,  0.833333279655,  0.990095087163],
                          [ 0.083333333333,  0.166666612988,  0.240095087163],
                          [ 0.083333333333,  0.166666612988,  0.490095087163],
                          [ 0.083333333333,  0.166666612988,  0.740095087163],
                          [ 0.083333333333,  0.166666612988,  0.990095087163],
                          [ 0.083333333333,  0.499999946322,  0.240095087163],
                          [ 0.083333333333,  0.499999946322,  0.490095087163],
                          [ 0.083333333333,  0.499999946322,  0.740095087163],
                          [ 0.083333333333,  0.499999946322,  0.990095087163],
                          [ 0.083333333333,  0.833333279655,  0.240095087163],
                          [ 0.083333333333,  0.833333279655,  0.490095087163],
                          [ 0.083333333333,  0.833333279655,  0.740095087163],
                          [ 0.083333333333,  0.833333279655,  0.990095087163],
                          [ 0.416666666667,  0.166666612988,  0.240095087163],
                          [ 0.416666666667,  0.166666612988,  0.490095087163],
                          [ 0.416666666667,  0.166666612988,  0.740095087163],
                          [ 0.416666666667,  0.166666612988,  0.990095087163],
                          [ 0.416666666667,  0.499999946322,  0.240095087163],
                          [ 0.416666666667,  0.499999946322,  0.490095087163],
                          [ 0.416666666667,  0.499999946322,  0.740095087163],
                          [ 0.416666666667,  0.499999946322,  0.990095087163],
                          [ 0.416666666667,  0.833333279655,  0.240095087163],
                          [ 0.416666666667,  0.833333279655,  0.490095087163],
                          [ 0.416666666667,  0.833333279655,  0.740095087163],
                          [ 0.416666666667,  0.833333279655,  0.990095087163],
                          [ 0.75          ,  0.166666612988,  0.240095087163],
                          [ 0.75          ,  0.166666612988,  0.490095087163],
                          [ 0.75          ,  0.166666612988,  0.740095087163],
                          [ 0.75          ,  0.166666612988,  0.990095087163],
                          [ 0.75          ,  0.499999946322,  0.240095087163],
                          [ 0.75          ,  0.499999946322,  0.490095087163],
                          [ 0.75          ,  0.499999946322,  0.740095087163],
                          [ 0.75          ,  0.499999946322,  0.990095087163],
                          [ 0.75          ,  0.833333279655,  0.240095087163],
                          [ 0.75          ,  0.833333279655,  0.490095087163],
                          [ 0.75          ,  0.833333279655,  0.740095087163],
                          [ 0.75          ,  0.833333279655,  0.990095087163]]

# Set up configuration
bulk_configuration = BulkConfiguration(
    bravais_lattice=lattice,
    elements=elements,
    fractional_coordinates=fractional_coordinates
    )

# Define regions.
bottom =[  1,   5,   9,  13,  17,  21,  25,  29,  33,  37,
          41,  45,  49,  53,  57,  61,  65,  69,  73,  77,
          81,  85,  89,  93,  97, 101, 105, 109, 113, 117,
         121, 125, 129, 133, 137, 141, 145, 149, 153, 157,
         161, 165, 169, 173, 177, 181, 185, 189, 193, 197,
         201, 205, 209, 213, 217, 221, 225, 229, 233, 237,
         241, 245, 249, 253, 257, 261, 265, 269, 273, 277,
         281, 285, 289, 293, 297, 301, 305, 309, 313, 317,
         321, 325, 329, 333, 337, 341, 345, 349, 353, 357,
         361, 365, 369, 373, 377, 381, 385, 389, 393, 397,
         401, 405, 409, 413, 417, 421, 425, 429, 433, 437,
         441, 445, 449, 453, 457, 461, 465, 469, 473, 477,
         481, 485, 489, 493, 497, 501, 505, 509, 513, 517,
         521, 525, 529, 533, 537, 541, 545, 549, 553, 557,
         561, 565, 569, 573]
reservoir = [  0,   4,   8,  12,  16,  20,  24,  28,  32,  36,
              40,  44,  48,  52,  56,  60,  64,  68,  72,  76,
              80,  84,  88,  92,  96, 100, 104, 108, 112, 116,
             120, 124, 128, 132, 136, 140, 144, 148, 152, 156,
             160, 164, 168, 172, 176, 180, 184, 188, 192, 196,
             200, 204, 208, 212, 216, 220, 224, 228, 232, 236,
             240, 244, 248, 252, 256, 260, 264, 268, 272, 276,
             280, 284, 288, 292, 296, 300, 304, 308, 312, 316,
             320, 324, 328, 332, 336, 340, 344, 348, 352, 356,
             360, 364, 368, 372, 376, 380, 384, 388, 392, 396,
             400, 404, 408, 412, 416, 420, 424, 428, 432, 436,
             440, 444, 448, 452, 456, 460, 464, 468, 472, 476,
             480, 484, 488, 492, 496, 500, 504, 508, 512, 516,
             520, 524, 528, 532, 536, 540, 544, 548, 552, 556,
             560, 564, 568, 572]
substrate = [  2,   3,   6,   7,  10,  11,  14,  15,  18,  19,
              22,  23,  26,  27,  30,  31,  34,  35,  38,  39,
              42,  43,  46,  47,  50,  51,  54,  55,  58,  59,
              62,  63,  66,  67,  70,  71,  74,  75,  78,  79,
              82,  83,  86,  87,  90,  91,  94,  95,  98,  99,
             102, 103, 106, 107, 110, 111, 114, 115, 118, 119,
             122, 123, 126, 127, 130, 131, 134, 135, 138, 139,
             142, 143, 146, 147, 150, 151, 154, 155, 158, 159,
             162, 163, 166, 167, 170, 171, 174, 175, 178, 179,
             182, 183, 186, 187, 190, 191, 194, 195, 198, 199,
             202, 203, 206, 207, 210, 211, 214, 215, 218, 219,
             222, 223, 226, 227, 230, 231, 234, 235, 238, 239,
             242, 243, 246, 247, 250, 251, 254, 255, 258, 259,
             262, 263, 266, 267, 270, 271, 274, 275, 278, 279,
             282, 283, 286, 287, 290, 291, 294, 295, 298, 299,
             302, 303, 306, 307, 310, 311, 314, 315, 318, 319,
             322, 323, 326, 327, 330, 331, 334, 335, 338, 339,
             342, 343, 346, 347, 350, 351, 354, 355, 358, 359,
             362, 363, 366, 367, 370, 371, 374, 375, 378, 379,
             382, 383, 386, 387, 390, 391, 394, 395, 398, 399,
             402, 403, 406, 407, 410, 411, 414, 415, 418, 419,
             422, 423, 426, 427, 430, 431, 434, 435, 438, 439,
             442, 443, 446, 447, 450, 451, 454, 455, 458, 459,
             462, 463, 466, 467, 470, 471, 474, 475, 478, 479,
             482, 483, 486, 487, 490, 491, 494, 495, 498, 499,
             502, 503, 506, 507, 510, 511, 514, 515, 518, 519,
             522, 523, 526, 527, 530, 531, 534, 535, 538, 539,
             542, 543, 546, 547, 550, 551, 554, 555, 558, 559,
             562, 563, 566, 567, 570, 571, 574, 575]

# Add tags
bulk_configuration.addTags('bottom', bottom)
bulk_configuration.addTags('reservoir', reservoir)
bulk_configuration.addTags('substrate', substrate)

# -------------------------------------------------------------
# Calculator
# -------------------------------------------------------------

potentialSet = Tersoff_SiC_2005()
calculator = TremoloXCalculator(parameters=potentialSet)

bulk_configuration.setCalculator(calculator)
bulk_configuration.update()

# -------------------------------------------------------------
# Optimize Geometry
# -------------------------------------------------------------
bulk_configuration = OptimizeGeometry(
        bulk_configuration,
        max_forces=0.001*eV/Ang,
        max_stress=0.001*eV/Ang**3,
        max_steps=200,
        max_step_length=0.2*Ang,
        trajectory_filename=None,
        optimizer_method=LBFGS(),
        )
# nlsave('SiC_bulk_opt.nc', bulk_configuration)

cell = bulk_configuration.bravaisLattice().primitiveVectors()
cartesian_coordinates = bulk_configuration.cartesianCoordinates()

# Set the off-diagonal cell compoents to zero.
cell[0, 1] = 0.0*Angstrom
cell[0, 2] = 0.0*Angstrom
cell[1, 2] = 0.0*Angstrom
cell[1, 0] = 0.0*Angstrom
cell[2, 0] = 0.0*Angstrom
cell[2, 1] = 0.0*Angstrom

# Increase the height of the cell.
cell[2, 2] = 100.0*Angstrom
lattice = UnitCell(cell[0], cell[1], cell[2])

# Shift the coordinates upwards to avoid spurious PBC-wrapping at
# the bottom of the cell.
cartesian_coordinates[:, 2] = cartesian_coordinates[:, 2] + 5.0*Angstrom

# Build a new configuration with the modified cell and coordinates.
bulk_configuration = BulkConfiguration(
    bravais_lattice=lattice,
    elements=elements,
    cartesian_coordinates=cartesian_coordinates
    )

# Add tags
bulk_configuration.addTags('bottom', bottom)
bulk_configuration.addTags('reservoir', reservoir)
bulk_configuration.addTags('substrate', substrate)

# Add calculator.
bulk_configuration.setCalculator(calculator)

# -------------------------------------------------------------
# Molecular Dynamics for Equilibration of the Surface
# -------------------------------------------------------------

initial_velocity = MaxwellBoltzmannDistribution(
    temperature=2400.0*Kelvin,
    remove_center_of_mass_momentum=True
)

method = Langevin(
    time_step=1*femtoSecond,
    reservoir_temperature=2400*Kelvin,
    friction=0.01*femtoSecond**-1,
    initial_velocity=initial_velocity
)

md_trajectory = MolecularDynamics(
    bulk_configuration,
    constraints=bottom+reservoir,
    trajectory_filename='SiC_surface_equilibrate_md.nc',
    steps=100000,
    log_interval=5000,
    method=method
)

bulk_configuration = md_trajectory.lastImage()
bulk_configuration.setCalculator(calculator)

# ------------------------------------------------------------
# Define a hook class to deposit atoms from the reservoir
# onto the active surface of the substrate.
# ------------------------------------------------------------

class VaporDepositionHook:
    def __init__(self,
                 deposition_interval,
                 configuration,
                 substrate_atoms,
                 vapor_temperature=300.0*Kelvin):
        """
        Constructor
        """
        # Store the parameters.

        # The interval after which a new atoms is deposited.
        self._deposition_interval = deposition_interval

        # Store the original coordinates. They will be used to constrain the reservoir atoms.
        self._original_coordinates = configuration.cartesianCoordinates().inUnitsOf(Angstrom)

        # The indices of the atoms that should not be deposited
        self._substrate_atoms = substrate_atoms

        # The vapor temperature.
        self._vapor_temperature = vapor_temperature

        # Deposition count.
        self._deposited_index = 0

        # Get the atoms in the reservoir, i.e. all with z-coordinates lower
        # than the fixed bottom of the substrate.
        self._lowest_substrate = self._original_coordinates[self._substrate_atoms, 2].min()
        self._reservoir_indices = numpy.where(self._original_coordinates[:, 2] < self._lowest_substrate - 0.1)[0].tolist()

        # Get the lattice vectors.
        cell = configuration.bravaisLattice().primitiveVectors().inUnitsOf(Angstrom)
        self._lx = cell[0, 0]
        self._ly = cell[1, 1]
        self._lz = cell[2 ,2]

    def __call__(self, step, time, configuration, forces, stress):
        """ Call the hook during MD. """
        # Get the coordinates.
        coordinates = configuration.cartesianCoordinates().inUnitsOf(Angstrom)

        # The reservoir is composed of all atoms that are below the bottom
        # layer of the substrate
        # or above the ceiling of the cell.
        self._reservoir_indices = numpy.where((coordinates[:, 2] < self._lowest_substrate - 0.1) |
                                              (coordinates[:, 2] > self._lz))[0]

        # Freeze the reservoir atoms and reset their positions at every step.
        velocities = configuration.velocities()
        velocities[self._reservoir_indices, :] = 0.0*Angstrom/fs
        configuration._changeAtoms(indices=self._reservoir_indices,
                                   positions=self._original_coordinates[self._reservoir_indices]*Angstrom)

        # Check if it is time for the deposition of a new atom from the reservoir.
        if (step % self._deposition_interval) == 0:
            # Get elements and velocities.
            elements = numpy.array(configuration.elements())
            velocities = configuration.velocities().inUnitsOf(Angstrom/fs)

            # If the reservoir is empty, do nothing.
            if len(self._reservoir_indices) == 0:
                return

            # Decide which element to deposit next.
            possible_elements = [Silicon, Carbon]
            element_index = self._deposited_index % 2
            next_element = possible_elements[element_index]
            reservoir_elements = elements[self._reservoir_indices]

            # Get the element candidates.
            possible_atoms = numpy.where(reservoir_elements == next_element)[0]

            # If not avaiblable, try the other element.
            if len(possible_atoms) == 0:
                next_element = possible_elements[element_index-1]
                possible_atoms = numpy.where(reservoir_elements == next_element)[0]

            # Return back the global atom indices.
            possible_atoms = self._reservoir_indices[possible_atoms]

            # Pick an atom at the bottom of the reservoir
            lowest_atom = numpy.argmin(coordinates[possible_atoms, 2])
            next_index = possible_atoms[lowest_atom]

            # Place the deposition atom above the surface at a random lateral position.
            new_coords = numpy.array([numpy.random.uniform()*self._lx,
                                      numpy.random.uniform()*self._ly,
                                      self._lz - 15.0])

            configuration._changeAtoms(indices=[next_index], positions=new_coords*Angstrom)
            wrap(configuration)

            # Draw random velocities for the atom according to
            # Maxwell-Boltzmann at the specified temperature.
            m = next_element.atomicMass()
            sig = self._vapor_temperature*boltzmann_constant/m
            sig = sig.inUnitsOf(Ang**2/fs**2)
            sig = numpy.sqrt(sig)

            new_velocity = numpy.random.normal(scale=sig, size=3)
            velocity_norm = numpy.linalg.norm(new_velocity)

            # Set the velocity so that it points towards the active surface.
            new_velocity = numpy.array([0.0, 0.0, -velocity_norm])
            velocities[next_index] = new_velocity

            # Set the new velocities on the configuration.
            configuration.setVelocities(velocities*Angstrom/fs)

            self._deposited_index += 1

# ------------------------------------------------------------
# End of hook class definition
# ------------------------------------------------------------

# Initialize the hook class.
deposition_hook = VaporDepositionHook(deposition_interval=5000,
                                      configuration=bulk_configuration,
                                      substrate_atoms=substrate+bottom,
                                      vapor_temperature=2400.0*Kelvin)

# -------------------------------------------------------------
# Molecular Dynamics to simulate the Deposition
# -------------------------------------------------------------

initial_velocity = ConfigurationVelocities(
    remove_center_of_mass_momentum=False
)

# Define an NVT thermostat where only the substrate atoms are thermalized.
method = NVTNoseHoover(
    time_step=1*femtoSecond,
    reservoir_temperature=[('substrate', 2400*Kelvin)],
    thermostat_timescale=100*femtoSecond,
    heating_rate=0*Kelvin/picoSecond,
    chain_length=3,
    initial_velocity=initial_velocity
)

md_trajectory = MolecularDynamics(
    bulk_configuration,
    constraints=bottom,
    trajectory_filename='SiC_deposit_tutorial_md.nc',
    steps=800000,
    post_step_hook=deposition_hook,
    log_interval=2500,
    method=method
)

bulk_configuration = md_trajectory.lastImage()
